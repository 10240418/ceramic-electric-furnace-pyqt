# ============================================================
# 电炉上位机 - DB19 料仓控制数据配置
# 配置文件: 料仓排料控制标志
# 适用场景: 投料记录触发信号
# ============================================================

# 系统概述
system:
  name: 料仓排料控制标志
  version: "1.0"
  description: DB19 料仓排料控制标志 (本次排料重量待读取标志)

# ============================================================
# DB19 - 料仓控制数据块定义
# PLC: CPU 1214C AC/DC/Rly
# 总大小: 4 bytes (offset 0~3)
# ============================================================
# 数据结构概述:
#   - offset 2.3: 本次排料重量待读取标志 (Bool)
#   - offset 2.4: 保留 (Bool)
# ============================================================
# 读取逻辑:
#   1. 每0.5秒轮询读取 DB19 offset 2 (1字节)
#   2. 提取 bit 3 (offset 2.3) 作为待读取标志
#   3. 当标志为 True 时，读取 DB18 offset 16-19 的本次排料重量
#   4. 读取完成后，PLC 外部会将标志复位为 False
# ============================================================

db19_hopper_control:
  db_block: 19
  name: "HOPPER_CONTROL"
  total_size: 4  # offset 0 ~ 3 (实际只用到 offset 2)
  
  # 字段定义列表
  fields:
    # ----------------------
    # 本次排料重量待读取标志 (Bool 类型) offset 2.3
    # ----------------------
    - name: discharge_weight_ready
      offset: 2
      bit: 3
      type: BOOL
      description: 本次排料重量待读取标志 (True=有新的排料重量可读取)
      notes: |
        - PLC 完成一次排料后，将此标志置为 True
        - 上位机检测到 True 后，读取 DB18 offset 16-19 的本次排料重量
        - 读取完成后，PLC 外部会将标志复位为 False
        - 此标志用于触发投料记录的生成

