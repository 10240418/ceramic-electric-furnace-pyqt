---
alwaysApply: true
---

# #3ç”µç‚‰ - PyQt6 å‰ç«¯ + åç«¯é›†æˆé¡¹ç›®è§„åˆ™

## é¡¹ç›®æ¦‚è¿°

è¿™æ˜¯#3ç”µç‚‰çš„ **å‰åç«¯ä¸€ä½“åŒ–é¡¹ç›®**ï¼Œè´Ÿè´£ï¼š
- **å‰ç«¯**: PyQt6 å®æ—¶æ•°æ®å¯è§†åŒ–ã€ç”¨æˆ·äº¤äº’ç•Œé¢ã€å†å²æ•°æ®æŸ¥è¯¢ã€æŠ¥è­¦æ˜¾ç¤º
- **åç«¯**: PLC æ•°æ®é‡‡é›†ã€æ•°æ®å¤„ç†è®¡ç®—ã€InfluxDB å­˜å‚¨ã€ä¸šåŠ¡é€»è¾‘
- **æ¶æ„**: å•è¿›ç¨‹å¤šçº¿ç¨‹ï¼ˆPyQt6 ä¸»çº¿ç¨‹ + Asyncio åç«¯çº¿ç¨‹ï¼‰

## æŠ€æœ¯æ ˆ

- **è¯­è¨€**: Python 3.12+
- **å‰ç«¯æ¡†æ¶**: PyQt6 6.10+
- **å›¾è¡¨åº“**: PyQtGraph
- **åç«¯é€šä¿¡**: Snap7 (PLC), pymodbus (Modbus)
- **æ•°æ®åº“**: InfluxDB 2.x, SQLite (æŠ¥è­¦)
- **æ ·å¼**: QSS (ç±»ä¼¼ CSS)
- **æ¶æ„**: å•è¿›ç¨‹å¤šçº¿ç¨‹ + Asyncio äº‹ä»¶å¾ªç¯

## é¡¹ç›®ç»“æ„

```
ceramic-electric-furnace-pyqt/
â”œâ”€â”€ backend/                    #  åç«¯æ ¸å¿ƒï¼ˆå·²é›†æˆï¼‰
â”‚   â”œâ”€â”€ bridge/                 # å‰åç«¯æ¡¥æ¥å±‚
â”‚   â”‚   â”œâ”€â”€ service_manager.py  # æœåŠ¡ç®¡ç†å™¨ï¼ˆæ ¸å¿ƒï¼‰
â”‚   â”‚   â”œâ”€â”€ data_bridge.py      # Qt ä¿¡å·æ¡¥æ¥å™¨
â”‚   â”‚   â”œâ”€â”€ data_cache.py       # çº¿ç¨‹å®‰å…¨ç¼“å­˜
â”‚   â”‚   â””â”€â”€ data_models.py      # æ•°æ®æ¨¡å‹
â”‚   â”œâ”€â”€ core/                   # InfluxDB, æŠ¥è­¦å­˜å‚¨
â”‚   â”œâ”€â”€ plc/                    # PLC é€šä¿¡å±‚ï¼ˆè§£æå™¨ã€ç®¡ç†å™¨ï¼‰
â”‚   â”œâ”€â”€ services/               # ä¸šåŠ¡æœåŠ¡å±‚ï¼ˆè½®è¯¢ã€è®¡ç®—ã€æ‰¹æ¬¡ï¼‰
â”‚   â”œâ”€â”€ tools/                  # å·¥å…·å±‚ï¼ˆè½¬æ¢å™¨ã€æ»¤æ³¢å™¨ï¼‰
â”‚   â”œâ”€â”€ configs/                # YAML é…ç½®æ–‡ä»¶
â”‚   â”œâ”€â”€ tests/                  # æµ‹è¯•ä»£ç ï¼ˆå« Mockï¼‰
â”‚   â””â”€â”€ config.py               # åç«¯é…ç½®
â”œâ”€â”€ ui/                         # ğŸ¨ PyQt6 å‰ç«¯
â”‚   â”œâ”€â”€ main_window.py          # ä¸»çª—å£ï¼ˆé›†æˆåç«¯æœåŠ¡ï¼‰
â”‚   â”œâ”€â”€ pages/                  # é¡µé¢å±‚
â”‚   â”‚   â”œâ”€â”€ page_elec_3.py      # 3#ç”µç‚‰é¡µé¢
â”‚   â”‚   â”œâ”€â”€ page_history_curve.py
â”‚   â”‚   â”œâ”€â”€ page_status.py
â”‚   â”‚   â””â”€â”€ page_pump_hopper.py
â”‚   â”œâ”€â”€ widgets/                # ç»„ä»¶å±‚
â”‚   â”‚   â”œâ”€â”€ common/             # é€šç”¨ç»„ä»¶
â”‚   â”‚   â”œâ”€â”€ realtime_data/      # å®æ—¶æ•°æ®ç»„ä»¶
â”‚   â”‚   â”œâ”€â”€ history_curve/      # å†å²æ›²çº¿ç»„ä»¶
â”‚   â”‚   â””â”€â”€ status/             # çŠ¶æ€ç›‘æ§ç»„ä»¶
â”‚   â””â”€â”€ styles/                 # æ ·å¼å±‚
â”‚       â”œâ”€â”€ colors.py           # é¢œè‰²å¸¸é‡
â”‚       â”œâ”€â”€ themes.py           # ä¸»é¢˜ç®¡ç†å™¨
â”‚       â””â”€â”€ qss_styles.py       # QSS æ ·å¼è¡¨
â”œâ”€â”€ assets/                     # èµ„æºæ–‡ä»¶
â”œâ”€â”€ logs/                       # æ—¥å¿—
â”œâ”€â”€ vdoc/                       # æ–‡æ¡£
â”œâ”€â”€ config.py                   # å‰ç«¯é…ç½®
â”œâ”€â”€ main.py                     # ğŸš€ ç»Ÿä¸€å…¥å£ï¼ˆå‰åç«¯ä¸€ä½“ï¼‰
â””â”€â”€ requirements.txt            # ä¾èµ–ï¼ˆå·²åˆå¹¶ï¼‰
```

## æ¶æ„è®¾è®¡

### å•è¿›ç¨‹å¤šçº¿ç¨‹æ¶æ„

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    å•ä¸ª Python è¿›ç¨‹                        â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                           â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”           â”‚
â”‚  â”‚  PyQt6 GUI  â”‚         â”‚   åç«¯æœåŠ¡å±‚      â”‚           â”‚
â”‚  â”‚  (ä¸»çº¿ç¨‹)    â”‚â—„â”€â”€â”€â”€â”€â”€â”€â”€â”¤  (Asyncio çº¿ç¨‹)   â”‚           â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  ä¿¡å·æ§½  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜           â”‚
â”‚        â–²                          â”‚                      â”‚
â”‚        â”‚                          â–¼                      â”‚
â”‚        â”‚                  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”              â”‚
â”‚        â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤ çº¿ç¨‹å®‰å…¨ç¼“å­˜  â”‚              â”‚
â”‚                           â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜              â”‚
â”‚                                  â–²                       â”‚
â”‚                                  â”‚                       â”‚
â”‚                          â”Œâ”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”             â”‚
â”‚                          â”‚                 â”‚             â”‚
â”‚                   â”Œâ”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”   â”Œâ”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”      â”‚
â”‚                   â”‚ PLC è½®è¯¢    â”‚   â”‚Modbus è½®è¯¢ â”‚      â”‚
â”‚                   â”‚ (asyncio)   â”‚   â”‚ (asyncio)  â”‚      â”‚
â”‚                   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜      â”‚
â”‚                          â”‚                 â”‚             â”‚
â”‚                          â–¼                 â–¼             â”‚
â”‚                      â”Œâ”€â”€â”€â”€â”€â”          â”Œâ”€â”€â”€â”€â”€â”€â”          â”‚
â”‚                      â”‚ PLC â”‚          â”‚æ–™ä»“ç§¤ â”‚          â”‚
â”‚                      â””â”€â”€â”€â”€â”€â”˜          â””â”€â”€â”€â”€â”€â”€â”˜          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### å…³é”®ç»„ä»¶

**ServiceManagerï¼ˆæœåŠ¡ç®¡ç†å™¨ï¼‰**
- ä½ç½®: `backend/bridge/service_manager.py`
- åŠŸèƒ½: åœ¨ç‹¬ç«‹çº¿ç¨‹ä¸­è¿è¡Œ asyncio äº‹ä»¶å¾ªç¯ï¼Œå¯åŠ¨æ‰€æœ‰åç«¯è½®è¯¢æœåŠ¡
- æ”¯æŒ: Mock æ¨¡å¼å’ŒçœŸå® PLC æ¨¡å¼

**DataBridgeï¼ˆæ•°æ®æ¡¥æ¥å™¨ï¼‰**
- ä½ç½®: `backend/bridge/data_bridge.py`
- åŠŸèƒ½: ä½¿ç”¨ PyQt6 ä¿¡å·æœºåˆ¶ï¼Œå°†åç«¯æ•°æ®å®‰å…¨ä¼ é€’åˆ°ä¸»çº¿ç¨‹

**DataCacheï¼ˆçº¿ç¨‹å®‰å…¨ç¼“å­˜ï¼‰**
- ä½ç½®: `backend/bridge/data_cache.py`
- åŠŸèƒ½: ä½¿ç”¨ `threading.RLock` ä¿è¯çº¿ç¨‹å®‰å…¨ï¼Œåç«¯å†™å…¥ï¼Œå‰ç«¯è¯»å–

## å¼€å‘ç­–ç•¥

### ğŸ¨ UI ä¼˜å…ˆç­–ç•¥

1. **é˜¶æ®µ 1-4**: ç¯å¢ƒå‡†å¤‡ã€æ ·å¼ç³»ç»Ÿã€åŸºç¡€çª—å£ 
2. **é˜¶æ®µ 5-7**: æ ¸å¿ƒç»„ä»¶ã€é¡µé¢ UIï¼ˆä½¿ç”¨æ¨¡æ‹Ÿæ•°æ®ï¼‰
3. **é˜¶æ®µ 8-9**: åå°çº¿ç¨‹é›†æˆã€åŠŸèƒ½å®Œå–„
4. **é˜¶æ®µ 10**: æµ‹è¯•ä¼˜åŒ–ã€æ‰“åŒ…éƒ¨ç½²

**å½“å‰è¿›åº¦**: å·²å®Œæˆåç«¯é›†æˆ 

## ç¼–ç è§„èŒƒ

### 1. å‘½åè§„èŒƒ

#### 1.1 åŸºç¡€å‘½åè§„åˆ™

- **æ–‡ä»¶å**: å°å†™ä¸‹åˆ’çº¿ `snake_case.py`
- **ç±»å**: å¤§é©¼å³° `PascalCase`
- **å‡½æ•°/å˜é‡**: å°å†™ä¸‹åˆ’çº¿ `snake_case`
- **å¸¸é‡**: å¤§å†™ä¸‹åˆ’çº¿ `UPPER_SNAKE_CASE`
- **ä¿¡å·**: å°å†™ä¸‹åˆ’çº¿ `signal_name`

#### 1.2 ç»„ä»¶å‘½åè§„èŒƒ â­

**ç»„ä»¶æ–‡ä»¶åå’Œç±»åå¿…é¡»éµå¾ª"ç»„ä»¶ç±»å‹_åŠŸèƒ½æè¿°"æ ¼å¼**ï¼š

 **æ­£ç¡®å‘½å**ï¼š
```python
# æ–‡ä»¶å: button_tech.py
class ButtonTech(QPushButton):
    """ç§‘æŠ€é£æ ¼æŒ‰é’®"""
    pass

# æ–‡ä»¶å: panel_tech.py
class PanelTech(QFrame):
    """ç§‘æŠ€é£æ ¼é¢æ¿"""
    pass

# æ–‡ä»¶å: card_data.py
class CardData(QFrame):
    """æ•°æ®å¡ç‰‡"""
    pass
```

 **é”™è¯¯å‘½å**ï¼š
```python
# æ–‡ä»¶å: tech_button.py (é”™è¯¯ï¼šåŠŸèƒ½åœ¨å‰)
class TechButton(QPushButton):
    pass
```

**å‘½åè§„åˆ™è¯´æ˜**ï¼š

1. **ç»„ä»¶ç±»å‹åœ¨å‰**ï¼šå…ˆè¯´æ˜æ˜¯ä»€ä¹ˆç»„ä»¶ï¼ˆButtonã€Panelã€Labelã€Cardã€Chart ç­‰ï¼‰
2. **åŠŸèƒ½æè¿°åœ¨å**ï¼šå†è¯´æ˜å…·ä½“åŠŸèƒ½ï¼ˆTechã€Blinkingã€Dataã€Valve ç­‰ï¼‰
3. **æ–‡ä»¶åä¸ç±»åå¯¹åº”**ï¼š`button_tech.py` â†’ `ButtonTech`

**å¸¸è§ç»„ä»¶ç±»å‹å‰ç¼€**ï¼š

| ç»„ä»¶ç±»å‹ | è¯´æ˜ | ç¤ºä¾‹ |
|---------|------|------|
| `Button` | æŒ‰é’® | `ButtonTech`, `ButtonIcon` |
| `Panel` | é¢æ¿ | `PanelTech`, `PanelGlow` |
| `Label` | æ ‡ç­¾ | `LabelBlinking`, `LabelStatus` |
| `Card` | å¡ç‰‡ | `CardData`, `CardFurnace` |
| `Indicator` | æŒ‡ç¤ºå™¨ | `IndicatorValve`, `IndicatorStatus` |
| `Chart` | å›¾è¡¨ | `ChartElectrode`, `ChartHistory` |
| `Widget` | é€šç”¨ç»„ä»¶ | `WidgetElectrode`, `WidgetControl` |
| `Dialog` | å¯¹è¯æ¡† | `DialogSettings`, `DialogConfirm` |
| `Table` | è¡¨æ ¼ | `TableData`, `TableAlarm` |
| `Dropdown` | ä¸‹æ‹‰æ¡† | `DropdownTech`, `DropdownBatch` |
| `Switch` | å¼€å…³ | `SwitchTheme`, `SwitchMode` |

### 2. æ³¨é‡Šè§„èŒƒ

**ä½¿ç”¨åºå·+æ³¨é‡Šé£æ ¼ï¼Œä¸ä½¿ç”¨æ–‡æ¡£å­—ç¬¦ä¸²æ³¨è§£**ï¼š

```python
# 1. åˆå§‹åŒ–ç»„ä»¶
def __init__(self, title: str, parent=None):
    super().__init__(parent)
    self.title = title
    self.init_ui()

# 2. åˆå§‹åŒ– UI
def init_ui(self):
    layout = QVBoxLayout(self)
    # å¸ƒå±€ä»£ç 
```

 **ä¸è¦ä½¿ç”¨**ï¼š
```python
def __init__(self, title: str, parent=None):
    """åˆå§‹åŒ–ç»„ä»¶
    
    Args:
        title: æ ‡é¢˜
        parent: çˆ¶ç»„ä»¶
    """
    pass
```

**æ–‡ä»¶å¤´éƒ¨æ³¨é‡Š**ï¼š
```python
"""
æ–‡ä»¶åŠŸèƒ½ç®€çŸ­æè¿°ï¼ˆä¸€è¡Œå³å¯ï¼‰
"""
```

### 3. ä»£ç è®¾è®¡åŸåˆ™

**é¿å…è¿‡åº¦æŠ½è±¡**ï¼š
- **ä¸è¦æå‰æŠ½è±¡**ï¼šéœ€è¦ç”¨çš„æ—¶å€™å†æŠ½è±¡ï¼Œä¸è¦ä¸€å¼€å§‹å°±åˆ›å»ºå¤§é‡å·¥å…·æ–¹æ³•
- **é¿å…å†—ä½™æ–¹æ³•**ï¼šä¸€ä¸ªæ–‡ä»¶ä¸è¦æŠ½è±¡å‡ºå¤ªå¤šæ–¹æ³•ï¼Œä¿æŒç®€æ´
- **å®ç”¨ä¸»ä¹‰**ï¼šèƒ½ç›´æ¥å†™å°±ç›´æ¥å†™ï¼Œä¸è¦ä¸ºäº†"ä¼˜é›…"è€Œè¿‡åº¦å°è£…

 **å¥½çš„åšæ³•**ï¼š
```python
# 1. æ›´æ–°æ˜¾ç¤ºæ•°æ®
def update_display(self, data):
    # ç›´æ¥æ›´æ–°
    self.temp_label.setText(f"{data['temp']:.1f}Â°C")
    self.pressure_label.setText(f"{data['pressure']:.2f} MPa")
```

 **è¿‡åº¦æŠ½è±¡**ï¼š
```python
def _format_temperature(self, temp):
    return f"{temp:.1f}Â°C"

def _format_pressure(self, pressure):
    return f"{pressure:.2f} MPa"

def _update_label(self, label, text):
    label.setText(text)

def update_display(self, data):
    temp_text = self._format_temperature(data['temp'])
    press_text = self._format_pressure(data['pressure'])
    self._update_label(self.temp_label, temp_text)
    self._update_label(self.pressure_label, press_text)
```

## å‰åç«¯é›†æˆè§„èŒƒ

### 1. åœ¨ MainWindow ä¸­é›†æˆåç«¯æœåŠ¡

```python
from PyQt6.QtWidgets import QMainWindow
from backend.bridge.service_manager import ServiceManager
from backend.bridge.data_bridge import DataBridge
from backend.bridge.data_cache import DataCache

class MainWindow(QMainWindow):
    
    # 1. åˆå§‹åŒ–ä¸»çª—å£
    def __init__(self, use_mock: bool = True):
        super().__init__()
        
        # åç«¯æœåŠ¡ç®¡ç†å™¨
        self.service_manager = ServiceManager(use_mock=use_mock)
        
        # æ•°æ®æ¡¥æ¥å™¨ï¼ˆç”¨äºæ¥æ”¶åç«¯æ•°æ®ï¼‰
        self.data_bridge = DataBridge.get_instance()
        
        # æ•°æ®ç¼“å­˜ï¼ˆç”¨äºè¯»å–åç«¯æ•°æ®ï¼‰
        self.data_cache = DataCache.get_instance()
        
        # è¿æ¥åç«¯ä¿¡å·
        self.connect_backend_signals()
        
        # åˆå§‹åŒ– UI
        self.init_ui()
        
        # å¯åŠ¨åç«¯æœåŠ¡
        self.service_manager.start_all()
    
    # 2. è¿æ¥åç«¯ä¿¡å·
    def connect_backend_signals(self):
        # è¿æ¥é”™è¯¯ä¿¡å·
        self.data_bridge.error_occurred.connect(self.on_backend_error)
        
        # å¯ä»¥è¿æ¥æ›´å¤šä¿¡å·
        # self.data_bridge.arc_data_updated.connect(self.on_arc_data_updated)
    
    # 3. å¤„ç†åç«¯é”™è¯¯
    def on_backend_error(self, error_msg: str):
        logger.error(f"åç«¯é”™è¯¯: {error_msg}")
    
    # 4. å…³é—­çª—å£æ—¶åœæ­¢åç«¯æœåŠ¡
    def closeEvent(self, event):
        self.service_manager.stop_all()
        event.accept()
```

### 2. åœ¨é¡µé¢/ç»„ä»¶ä¸­è¯»å–åç«¯æ•°æ®

```python
from backend.bridge.data_cache import DataCache

class PageElec3(QWidget):
    
    # 1. åˆå§‹åŒ–é¡µé¢
    def __init__(self):
        super().__init__()
        
        # è·å–æ•°æ®ç¼“å­˜
        self.data_cache = DataCache.get_instance()
        
        # åˆ›å»ºå®šæ—¶å™¨ï¼Œå®šæœŸè¯»å–æ•°æ®
        self.timer = QTimer()
        self.timer.timeout.connect(self.update_display)
        self.timer.start(200)  # 200ms åˆ·æ–°
    
    # 2. æ›´æ–°æ˜¾ç¤º
    def update_display(self):
        # ä»ç¼“å­˜è¯»å–æ•°æ®
        arc_data = self.data_cache.get("arc_data")
        if arc_data:
            self.display_arc_data(arc_data)
```

### 3. ä½¿ç”¨ä¿¡å·æ§½æ¥æ”¶å®æ—¶æ•°æ®

```python
from backend.bridge.data_bridge import DataBridge

class RealtimeWidget(QWidget):
    
    # 1. åˆå§‹åŒ–ç»„ä»¶
    def __init__(self):
        super().__init__()
        
        # è·å–æ•°æ®æ¡¥æ¥å™¨
        self.data_bridge = DataBridge.get_instance()
        
        # è¿æ¥ä¿¡å·
        self.data_bridge.arc_data_updated.connect(self.on_arc_data_updated)
    
    # 2. å¤„ç†æ•°æ®æ›´æ–°ï¼ˆä¸»çº¿ç¨‹ï¼ŒUI å®‰å…¨ï¼‰
    def on_arc_data_updated(self, data: dict):
        # æ›´æ–° UI
        self.arc_label.setText(f"å¼§æµ: {data['current']:.1f} A")
```

### 4. Mock æ¨¡å¼å¼€å‘

```python
# åœ¨ main.py ä¸­å¯åŠ¨ Mock æ¨¡å¼
if __name__ == "__main__":
    app = QApplication([])
    
    # use_mock=True: ä½¿ç”¨ Mock æ•°æ®ï¼Œæ— éœ€è¿æ¥çœŸå® PLC
    window = MainWindow(use_mock=True)
    
    window.showFullScreen()
    app.exec()
```
# 5 WidgetValveGrid ä½¿ç”¨çš„æ˜¯ QGridLayoutï¼Œè€Œ QGridLayout ä¸æ”¯æŒ stretch å‚æ•°ï¼
## ä¸»é¢˜ç³»ç»Ÿ

### 1. é¢œè‰²å¸¸é‡

**æ·±è‰²ä¸»é¢˜** (ç§‘æŠ€é£æ ¼):
- ä¸»è‰²: `#00d4ff` (é’è‰²)
- èƒŒæ™¯: `#0a0e27` (æ·±è“é»‘)
- å¡ç‰‡: `#1a1f3a`
- è¾¹æ¡†: `#2a3f5f`

**æµ…è‰²ä¸»é¢˜** (ç»¿è‰²ç³»):
- ä¸»è‰²: `#007663` (æ·±ç»¿)
- èƒŒæ™¯: `#E9EEA8` (æµ…é»„ç»¿)
- å¡ç‰‡: `#FFFFFF`
- è¾¹æ¡†: `#D4D9A0`

### 2. ä¸»é¢˜åˆ‡æ¢

```python
from ui.styles.themes import ThemeManager

theme_manager = ThemeManager()

# åˆ‡æ¢ä¸»é¢˜
theme_manager.toggle_theme()

# è·å–å½“å‰é¢œè‰²
colors = theme_manager.colors
primary_color = colors.primary
```

## æ€§èƒ½ä¼˜åŒ–ä¸çº¿ç¨‹å®‰å…¨

### 1. é¿å… UI å¡æ­»ï¼ˆæœ€é«˜ä¼˜å…ˆçº§ï¼‰

**åŸåˆ™**: æ‰€æœ‰è€—æ—¶æ“ä½œå¿…é¡»åœ¨åå°çº¿ç¨‹æ‰§è¡Œï¼ŒUI çº¿ç¨‹åªè´Ÿè´£æ˜¾ç¤º

```python
#  æ­£ç¡®ï¼šè€—æ—¶æ“ä½œåœ¨åå°çº¿ç¨‹
class DataProcessor(QThread):
    result_ready = pyqtSignal(dict)
    
    def run(self):
        # è€—æ—¶è®¡ç®—
        result = self.heavy_calculation()
        self.result_ready.emit(result)

#  é”™è¯¯ï¼šè€—æ—¶æ“ä½œåœ¨ UI çº¿ç¨‹
def on_button_clicked(self):
    result = self.heavy_calculation()  # ä¼šå¡æ­» UIï¼
    self.label.setText(str(result))
```

### 2. çº¿ç¨‹å®‰å…¨çš„æ•°æ®è®¿é—®

```python
#  æ­£ç¡®ï¼šä½¿ç”¨çº¿ç¨‹å®‰å…¨ç¼“å­˜
from backend.bridge.data_cache import DataCache

cache = DataCache.get_instance()
data = cache.get("arc_data")  # çº¿ç¨‹å®‰å…¨

#  æ­£ç¡®ï¼šä½¿ç”¨ä¿¡å·æ§½è·¨çº¿ç¨‹é€šä¿¡
self.data_bridge.arc_data_updated.connect(self.on_data_updated)

#  é”™è¯¯ï¼šç›´æ¥è·¨çº¿ç¨‹è®¿é—® UI
class WorkerThread(QThread):
    def run(self):
        self.label.setText("æ›´æ–°")  # è·¨çº¿ç¨‹è®¿é—® UIï¼
```

### 3. é¿å…é¢‘ç¹é‡ç»˜

```python
#  æ‰¹é‡æ›´æ–°
self.setUpdatesEnabled(False)
for item in items:
    self.update_item(item)
self.setUpdatesEnabled(True)

#  é¢‘ç¹æ›´æ–°
for item in items:
    self.update_item(item)
    self.update()  # æ¯æ¬¡éƒ½é‡ç»˜
```

## è°ƒè¯•æŠ€å·§

### 1. æ—¥å¿—è¾“å‡º

```python
from loguru import logger

logger.debug(f"ç»„ä»¶åˆå§‹åŒ–: {self.__class__.__name__}")
logger.info(f"æ•°æ®æ›´æ–°: {data}")
logger.warning(f"æ•°å€¼è¶…é™: {value} > {limit}")
logger.error(f"é”™è¯¯: {e}", exc_info=True)
```

### 2. æŸ¥çœ‹åç«¯æœåŠ¡çŠ¶æ€

```python
# åœ¨ MainWindow ä¸­
status = self.service_manager.get_status()
logger.info(f"åç«¯æœåŠ¡çŠ¶æ€: {status}")
```

## å¸¸è§é—®é¢˜

### 1. çª—å£ä¸æ˜¾ç¤º

```python
# ç¡®ä¿è°ƒç”¨ show() æˆ– showFullScreen()
window = MainWindow()
window.showFullScreen()  # æˆ– window.show()
```

### 2. åç«¯æ•°æ®è¯»å–ä¸åˆ°

```python
# æ£€æŸ¥åç«¯æœåŠ¡æ˜¯å¦å¯åŠ¨
status = self.service_manager.get_status()
print(status)

# æ£€æŸ¥ç¼“å­˜ä¸­æ˜¯å¦æœ‰æ•°æ®
data = self.data_cache.get("arc_data")
print(data)
```

### 3. UI å¡æ­»

```python
# æ£€æŸ¥æ˜¯å¦åœ¨ UI çº¿ç¨‹æ‰§è¡Œè€—æ—¶æ“ä½œ
# å°†è€—æ—¶æ“ä½œç§»åˆ°åå°çº¿ç¨‹æˆ–ä½¿ç”¨ asyncio
```

### 4. ä¿¡å·æ§½ä¸è§¦å‘

```python
# æ£€æŸ¥ä¿¡å·æ˜¯å¦æ­£ç¡®è¿æ¥
# æ£€æŸ¥æ§½å‡½æ•°ç­¾åæ˜¯å¦åŒ¹é…
# ä½¿ç”¨ Qt.ConnectionType.QueuedConnection è·¨çº¿ç¨‹è¿æ¥
signal.connect(slot, Qt.ConnectionType.QueuedConnection)
```

### 5. å¸ƒå±€ stretch å‚æ•°ä¸ç”Ÿæ•ˆ âš ï¸

**é—®é¢˜ç°è±¡**ï¼šè®¾ç½®äº† `addWidget(widget, stretch=X)`ï¼Œä½†ç»„ä»¶é«˜åº¦/å®½åº¦æ¯”ä¾‹ä¸ç¬¦åˆé¢„æœŸ

**å¸¸è§åŸå› **ï¼š

#### 5.1 ç»„ä»¶çš„ sizePolicy ä¸æ­£ç¡®

**é—®é¢˜**ï¼šç»„ä»¶çš„ sizePolicy æ˜¯ `Preferred`ï¼Œä¼šä¼˜å…ˆä½¿ç”¨ sizeHintï¼Œå¿½ç•¥ stretch

**è§£å†³æ–¹æ¡ˆ**ï¼šè®¾ç½®ä¸º `Expanding`

```python
from PyQt6.QtWidgets import QSizePolicy

# è®©ç»„ä»¶å®Œå…¨æŒ‰ç…§ stretch æ¯”ä¾‹åˆ†é…ç©ºé—´
widget.setSizePolicy(QSizePolicy.Policy.Expanding, QSizePolicy.Policy.Expanding)
layout.addWidget(widget, stretch=60)
```

#### 5.2 ç»„ä»¶æœ‰å›ºå®šçš„ minimumHeight/maximumHeight

**é—®é¢˜**ï¼šç»„ä»¶æˆ–å…¶å­ç»„ä»¶è®¾ç½®äº†å›ºå®šé«˜åº¦ï¼Œå¯¼è‡´ stretch å¤±æ•ˆ

**è¯Šæ–­æ–¹æ³•**ï¼š

```python
# æ£€æŸ¥ç»„ä»¶çš„é«˜åº¦é™åˆ¶
print(f"minimumHeight: {widget.minimumHeight()}")
print(f"maximumHeight: {widget.maximumHeight()}")
print(f"sizeHint: {widget.sizeHint().height()}")
print(f"minimumSizeHint: {widget.minimumSizeHint().height()}")
```

**è§£å†³æ–¹æ¡ˆ**ï¼š

```python
# ç§»é™¤å›ºå®šé«˜åº¦é™åˆ¶
# self.setMinimumHeight(120)  # æ³¨é‡Šæ‰æˆ–åˆ é™¤

# æˆ–è€…é‡å†™ sizeHint è¿”å›å°å€¼
def sizeHint(self):
    from PyQt6.QtCore import QSize
    return QSize(400, 100)  # è¿”å›ä¸€ä¸ªå°çš„é«˜åº¦å€¼

def minimumSizeHint(self):
    from PyQt6.QtCore import QSize
    return QSize(400, 100)  # è¿”å›ä¸€ä¸ªå°çš„é«˜åº¦å€¼
```

#### 5.3 QGridLayout çš„å­ç»„ä»¶æœ‰å›ºå®š sizeHint

**é—®é¢˜**ï¼š`QGridLayout` ä¼šæ ¹æ®æ‰€æœ‰å­ç»„ä»¶çš„ sizeHint è®¡ç®—æ€»é«˜åº¦ï¼Œå¯¼è‡´çˆ¶ç»„ä»¶çš„ sizeHint è¿‡å¤§

**ç¤ºä¾‹**ï¼š

```python
# WidgetValveGrid ä½¿ç”¨ QGridLayoutï¼ŒåŒ…å« 4 ä¸ª IndicatorValve
# æ¯ä¸ª IndicatorValve çš„ sizeHint æ˜¯ 170px
# 2 è¡Œ Ã— 170px = 340pxï¼ŒåŠ ä¸Šé—´è· = 346px
# è¿™ä¸ª 346px çš„ sizeHint ä¼šå¯¼è‡´ stretch å¤±æ•ˆ
```

**è§£å†³æ–¹æ¡ˆ**ï¼š

```python
# æ–¹æ¡ˆ 1ï¼šç»™æ¯ä¸ªå­ç»„ä»¶è®¾ç½® Expanding sizePolicy
class IndicatorValve(QFrame):
    def __init__(self, valve_id: int, parent=None):
        super().__init__(parent)
        # ...
        from PyQt6.QtWidgets import QSizePolicy
        self.setSizePolicy(QSizePolicy.Policy.Expanding, QSizePolicy.Policy.Expanding)

# æ–¹æ¡ˆ 2ï¼šé‡å†™çˆ¶ç»„ä»¶çš„ sizeHint
class WidgetValveGrid(QWidget):
    def sizeHint(self):
        from PyQt6.QtCore import QSize
        return QSize(400, 100)  # è¿”å›å°å€¼
    
    def minimumSizeHint(self):
        from PyQt6.QtCore import QSize
        return QSize(400, 100)  # è¿”å›å°å€¼
```

#### 5.4 å¸ƒå±€æœªæ¿€æ´» ğŸ”¥

**é—®é¢˜**ï¼šå¸ƒå±€åˆ›å»ºåæ²¡æœ‰æ¿€æ´»ï¼Œå¯¼è‡´ stretch å‚æ•°ä¸ç”Ÿæ•ˆ

**è¯Šæ–­æ–¹æ³•**ï¼š

```python
# æ£€æŸ¥ç»„ä»¶çš„å®é™…ä½ç½®å’Œå¤§å°
print(f"Widget 1 geometry: {widget1.geometry()}")
print(f"Widget 2 geometry: {widget2.geometry()}")

# å¦‚æœä¸¤ä¸ªç»„ä»¶çš„ä½ç½®éƒ½æ˜¯ (0, 0)ï¼Œè¯´æ˜å¸ƒå±€æœªæ¿€æ´»
# ä¾‹å¦‚ï¼š
# Widget 1 geometry: (0, 0, 640, 480)
# Widget 2 geometry: (0, 0, 640, 480)  # å®Œå…¨é‡å ï¼
```

**è§£å†³æ–¹æ¡ˆ**ï¼šåœ¨å¸ƒå±€åˆ›å»ºå®Œæˆåè°ƒç”¨ `activate()`

```python
# åˆ›å»ºå¸ƒå±€
layout = QVBoxLayout(self)
layout.addWidget(widget1, stretch=58)
layout.addWidget(widget2, stretch=42)

# æ¿€æ´»å¸ƒå±€ï¼Œè®© stretch ç”Ÿæ•ˆ
layout.activate()
```

#### 5.5 å®Œæ•´çš„è°ƒè¯•æµç¨‹

```python
# 1. æ£€æŸ¥ stretch å€¼
layout = widget.layout()
print(f"Stretch 0: {layout.stretch(0)}")
print(f"Stretch 1: {layout.stretch(1)}")

# 2. æ£€æŸ¥ sizePolicy
print(f"Widget 0 sizePolicy: {layout.itemAt(0).widget().sizePolicy().verticalPolicy()}")
print(f"Widget 1 sizePolicy: {layout.itemAt(1).widget().sizePolicy().verticalPolicy()}")

# 3. æ£€æŸ¥ sizeHint
print(f"Widget 0 sizeHint: {layout.itemAt(0).widget().sizeHint().height()}")
print(f"Widget 1 sizeHint: {layout.itemAt(1).widget().sizeHint().height()}")

# 4. æ£€æŸ¥å®é™…å‡ ä½•ä½ç½®
print(f"Widget 0 geometry: {layout.itemAt(0).widget().geometry()}")
print(f"Widget 1 geometry: {layout.itemAt(1).widget().geometry()}")

# 5. å¦‚æœä½ç½®é‡å ï¼Œè°ƒç”¨ activate()
if layout.itemAt(0).widget().geometry().y() == layout.itemAt(1).widget().geometry().y():
    print("å¸ƒå±€æœªæ¿€æ´»ï¼Œè°ƒç”¨ activate()")
    layout.activate()
    # é‡æ–°æ£€æŸ¥
    print(f"After activate - Widget 0 geometry: {layout.itemAt(0).widget().geometry()}")
    print(f"After activate - Widget 1 geometry: {layout.itemAt(1).widget().geometry()}")
```

#### 5.6 æœ€ä½³å®è·µæ€»ç»“

âœ… **æ­£ç¡®çš„åšæ³•**ï¼š

```python
# 1. åˆ›å»ºç»„ä»¶æ—¶è®¾ç½® Expanding sizePolicy
widget1 = MyWidget()
widget1.setSizePolicy(QSizePolicy.Policy.Expanding, QSizePolicy.Policy.Expanding)

widget2 = MyWidget()
widget2.setSizePolicy(QSizePolicy.Policy.Expanding, QSizePolicy.Policy.Expanding)

# 2. æ·»åŠ åˆ°å¸ƒå±€æ—¶è®¾ç½® stretch
layout = QVBoxLayout(self)
layout.addWidget(widget1, stretch=60)
layout.addWidget(widget2, stretch=40)

# 3. æ¿€æ´»å¸ƒå±€
layout.activate()

# 4. é¿å…åœ¨ç»„ä»¶ä¸­è®¾ç½®å›ºå®šé«˜åº¦
# ä¸è¦ä½¿ç”¨ï¼šself.setMinimumHeight(120)
# ä¸è¦ä½¿ç”¨ï¼šself.setFixedHeight(200)
```

âŒ **é”™è¯¯çš„åšæ³•**ï¼š

```python
# é”™è¯¯ 1ï¼šæ²¡æœ‰è®¾ç½® sizePolicy
layout.addWidget(widget1, stretch=60)  # sizePolicy é»˜è®¤æ˜¯ Preferredï¼Œä¼šä¼˜å…ˆä½¿ç”¨ sizeHint

# é”™è¯¯ 2ï¼šå­ç»„ä»¶æœ‰å›ºå®šé«˜åº¦
class MyWidget(QWidget):
    def __init__(self):
        super().__init__()
        self.setMinimumHeight(200)  # å›ºå®šé«˜åº¦ä¼šå¯¼è‡´ stretch å¤±æ•ˆ

# é”™è¯¯ 3ï¼šæ²¡æœ‰æ¿€æ´»å¸ƒå±€
layout.addWidget(widget1, stretch=60)
layout.addWidget(widget2, stretch=40)
# å¿˜è®°è°ƒç”¨ layout.activate()
```

## å¿«æ·é”®

| å¿«æ·é”® | åŠŸèƒ½ |
|--------|------|
| `F11` | åˆ‡æ¢å…¨å±/çª—å£æ¨¡å¼ |
| `Esc` | é€€å‡ºç¨‹åº |
| `Alt+F4` | é€€å‡ºç¨‹åº (Windows) |

## ä»£ç å®¡æŸ¥æ¸…å•

- [ ] æ˜¯å¦ç»§æ‰¿æ­£ç¡®çš„ Qt åŸºç±»ï¼Ÿ
- [ ] æ˜¯å¦ä½¿ç”¨ç±»å‹æ³¨è§£ï¼Ÿ
- [ ] æ˜¯å¦æ­£ç¡®é›†æˆåç«¯æœåŠ¡ï¼Ÿ
- [ ] æ˜¯å¦ä½¿ç”¨ä¸»é¢˜ç®¡ç†å™¨ï¼Ÿ
- [ ] æ˜¯å¦ä½¿ç”¨å¸ƒå±€ç®¡ç†å™¨ï¼Ÿ
- [ ] æ˜¯å¦æ­£ç¡®å¤„ç†ä¿¡å·æ§½ï¼Ÿ
- [ ] æ˜¯å¦çº¿ç¨‹å®‰å…¨ï¼Ÿ
- [ ] æ˜¯å¦ä¼šå¯¼è‡´ UI å¡æ­»ï¼Ÿ
- [ ] æ˜¯å¦æœ‰å†…å­˜æ³„æ¼ï¼Ÿ
- [ ] æ˜¯å¦ç¬¦åˆ UI è®¾è®¡è§„èŒƒï¼Ÿ

## å‚è€ƒæ–‡æ¡£

- `vdoc/BACKEND_INTEGRATION_COMPLETE.md` - åç«¯é›†æˆå®ŒæˆæŠ¥å‘Š
- `vdoc/IMPLEMENTATION_CHECKLIST.md` - å®æ–½è®¡åˆ’
- `vdoc/PHASE5_COMPLETE.md` - æ ¸å¿ƒç»„ä»¶å®ŒæˆæŠ¥å‘Š
- `README.md` - é¡¹ç›®è¯´æ˜

## å…¶ä»–è§„èŒƒ

- **PowerShell å‘½ä»¤**ï¼šä¸æ”¯æŒ `&&`ï¼Œä½¿ç”¨åˆ†å· `;` åˆ†éš”å‘½ä»¤
- **ç§°å‘¼**ï¼šæ¯æ¬¡å›ç­”å¿…é¡»ç§°å‘¼æˆ‘ä¸º"å¤§ç‹"
- **æµ‹è¯•æ–‡ä»¶**ï¼šä¸è¦åˆ›å»ºå¤šä½™çš„ md/py/test æ–‡ä»¶ï¼Œæµ‹è¯•å®Œæ¯•åä¸€å®šè¦åˆ é™¤,å¹¶ä¸”æˆ‘çš„ä»»ä½•æµ‹è¯•ä»£ç ä¸è¦ä½¿ç”¨ emoji.
- **æ–‡æ¡£ç®¡ç†**ï¼šmd æ–‡ä»¶éœ€è¦æ”¾åˆ° `vdoc/` ç›®å½•é‡Œé¢
- **ä»£ç æ•´æ´**ï¼šç›®å½•åŠ¡å¿…æ•´æ´ï¼Œä¿®æ”¹ä»£ç æ—¶åˆ é™¤æ—§ä»£ç ï¼Œä¸è¦å†—ä½™
- **å›ç­”æ‰§è¡Œè§„èŒƒ**ï¼šä½ æ˜¯ä¸€ä¸ªå¾ˆä¸¥æ ¼çš„python pyqt6å†™ä¸Šä½æœºçš„é«˜æ‰‹,ä½ å¾ˆä¸¥è°¨è®¤çœŸ,ä¸”å¯¹ä»£ç å¾ˆä¸¥è‹›,ä¸ä¼šå†™æ— ç”¨å†—ä½™ä»£ç ,å¹¶ä¸”å¾ˆå¤šé—®é¢˜,å¯¹äºæˆ‘å¸Œæœ›å®ç°çš„æ•ˆæœå’Œæ¶æ„ä½ ä¼šè®¤çœŸæ€è€ƒ,å¦‚æœæˆ‘çš„æè®®ä¸å¥½æˆ–è€…ä½ æœ‰æ›´å¥½çš„æ–¹æ¡ˆ,ä½ ä¼šè§„åŠæˆ‘.
- **æœ€é«˜ä¼˜å…ˆçº§**:å¯¹äºæˆ‘çš„æœ€ä¸»è¦çš„ä¸€ä¸ªåŠŸèƒ½å°±æ˜¯æˆ‘çš„è¿™ä¸ªpyqtçš„çª—å£å’Œæˆ‘çš„pyçš„åç«¯çš„æœåŠ¡çš„è¯,ä¸èƒ½æ­»æœºå¡æ­»,è¿™æ˜¯æœ€ä¸»è¦ä¹Ÿæ˜¯ä¼˜å…ˆçº§æœ€é«˜çš„ä¸€ä¸ªè¦æ±‚.
- **åé©³æˆ‘çš„å›ç­”** å¯¹äºæˆ‘è¯´çš„éœ€æ±‚ç­‰çš„è¯,è‚¯å®šä¼šæœ‰ä¸€äº›ä¸œè¥¿è¯´çš„ä¸ä¸“ä¸š,å¦‚æœä½ ç†è§£äº†çš„è¯,å°±å›ç­”æˆ‘,"å¤§ç‹,å°çš„ç½ªè¯¥ä¸‡æ­»,ä½†æ˜¯è¿™ä¸ªXXXX"è¿™æ ·å›ç­”.
- **ç¼–ç é—®é¢˜** æˆ‘çš„ä»£ç æ–‡ä»¶è‚¯å®šä¼šå°±æ˜¯æœ‰ä¸­æ–‡å’Œpythonä»£ç ,ä»¥åŠå¯èƒ½ä¼šæœ‰å›¾æ ‡,æ‰€ä»¥çš„è¯,ç”Ÿæˆçš„ä»£ç éœ€è¦è§„é¿ç¼–ç é—®é¢˜é”™è¯¯.
- **logä»¥åŠä»£ç æ–‡ä»¶** æˆ‘çš„ä»£ç æ–‡ä»¶ä»¥åŠlogçš„è¾“å‡ºçš„è¯,ç­‰ä¸€åˆ‡ä¸è¦ä½¿ç”¨å›¾æ ‡ç­‰æ ‡æ³¨. .è¿™æ ·çš„.
- **ä¸è¦è™šæ„** å›ç­”æˆ‘ä»¥åŠç”Ÿæˆçš„mdæ–‡ä»¶ä¹‹ä¸­ä¸€å®šè¦å’Œæˆ‘çš„å®é™…çš„ä»£ç æ–‡ä»¶ç›¸å…³,è€Œä¸æ˜¯è™šæ„çš„.
- **ä¸ä½¿ç”¨è™šæ‹Ÿç¯å¢ƒå¯åŠ¨python**
- **å¿…é¡»çœŸå®æœ‰æ•ˆçš„å›ç­”æˆ‘,ä¸èƒ½è™šæ„**ä¸è¦è™šæ„ä»»ä½•æˆ‘é¡¹ç›®æ²¡æœ‰çš„æ–‡ä»¶,å¦è€…æˆ‘ä¼šæ€ä¸‰åƒåªçŒ«.
